#!/bin/bash

nohup ./bin/pinot-admin.sh StartZookeeper -zkPort 2181 > zookeeper.log 2>&1 &
while ! grep -q 'Start zookeeper at localhost:2181 in thread main' zookeeper.log; do sleep 1; done
echo "Zookeeper started."

nohup ./bin/pinot-admin.sh StartController -config controller.conf > controller.log 2>&1 &
while ! grep -q 'INFO: \[HttpServer\] Started.' controller.log; do sleep 1; done
echo "Controller started."

nohup ./bin/pinot-admin.sh StartBroker -config broker.conf > broker.log 2>&1 &
while ! grep -q 'INFO: \[HttpServer\] Started.' broker.log; do sleep 1; done
echo "Broker started."

nohup ./bin/pinot-admin.sh StartServer -config server.conf > server.log 2>&1 &
while ! grep -q 'INFO: \[HttpServer\] Started.' server.log; do sleep 1; done
echo "Server started."

nohup ./bin/pinot-admin.sh StartMinion -configFileName minion.conf > minion.log 2>&1 &
while ! grep -q 'INFO: \[HttpServer\] Started.' minion.log; do sleep 1; done
echo "Minion started."

tail -f zookeeper.log controller.log broker.log server.log minion.log