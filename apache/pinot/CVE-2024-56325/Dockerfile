FROM ubuntu:24.04 AS jdk21-base
ENV DEBIAN_FRONTEND=noninteractive
ENV JAVA_HOME=/usr/lib/jvm/java-21-openjdk-amd64
RUN apt-get update && \
apt-get install -y --no-install-recommends \
openjdk-21-jdk \
ca-certificates \
curl \
&& apt-get clean \
&& rm -rf /var/lib/apt/lists/*
RUN java -version


FROM jdk21-base AS pinot

ARG PINOT_VERSION=1.2.0

RUN apt update && apt install wget -y
RUN wget https://www.apache.org/dyn/closer.lua/pinot/apache-pinot-${PINOT_VERSION}/apache-pinot-${PINOT_VERSION}-bin.tar.gz?action=download -O apache-pinot-${PINOT_VERSION}-bin.tar.gz
RUN tar -zxvf apache-pinot-${PINOT_VERSION}-bin.tar.gz

WORKDIR /apache-pinot-${PINOT_VERSION}-bin


COPY controller.conf controller.conf
COPY broker.conf broker.conf
COPY server.conf server.conf
COPY minion.conf minion.conf
COPY start-pinot.sh /apache-pinot-${PINOT_VERSION}-bin/start-pinot.sh
RUN chmod +x /apache-pinot-${PINOT_VERSION}-bin/start-pinot.sh

CMD ["./start-pinot.sh"]