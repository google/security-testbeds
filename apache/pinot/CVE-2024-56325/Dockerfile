FROM ubuntu:24.04 AS jdk21-base
ENV DEBIAN_FRONTEND=noninteractive
ENV JAVA_HOME=/usr/lib/jvm/java-21-openjdk-amd64
RUN apt-get update && \
apt-get install -y --no-install-recommends \
openjdk-21-jdk \
ca-certificates \
curl \
&& apt-get clean \
&& rm -rf /var/lib/apt/lists/*
RUN java -version


FROM jdk21-base AS pinot

RUN apt update && apt install wget -y
RUN wget https://www.apache.org/dyn/closer.lua/pinot/apache-pinot-1.2.0/apache-pinot-1.2.0-bin.tar.gz?action=download -O apache-pinot-1.2.0-bin.tar.gz
RUN tar -zxvf apache-pinot-1.2.0-bin.tar.gz

WORKDIR /apache-pinot-1.2.0-bin


COPY controller.conf controller.conf
COPY broker.conf broker.conf
COPY server.conf server.conf
COPY minion.conf minion.conf
COPY start-pinot.sh /apache-pinot-1.2.0-bin/start-pinot.sh
RUN chmod +x /apache-pinot-1.2.0-bin/start-pinot.sh

CMD ["/apache-pinot-1.2.0-bin/start-pinot.sh"]