# Copyright 2020 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# See options available at https://github.com/google/nsjail/blob/master/config.proto

name: "apache2-proxy-nsjail"
description: "Example nsjail configuration for containing a web server."

mode: LISTEN
uidmap {inside_id: "999"}
gidmap {inside_id: "999"}
mount_proc: true
rlimit_as_type: HARD
rlimit_cpu_type: HARD
rlimit_nofile_type: HARD
rlimit_nproc_type: HARD

cwd: "/var/lib/jetty"

envar: "HOSTNAME=0d8558d0915b"
envar: "LANGUAGE=en_US:en"
envar: "JAVA_HOME=/opt/java/openjdk"
envar: "PWD=/var/lib/jetty"
envar: "JETTY_HOME=/usr/local/jetty"
envar: "HOME=/var/lib/jetty"
envar: "LANG=en_US.UTF-8"
envar: "TMPDIR=/tmp/jetty"
envar: "JETTY_BASE=/var/lib/jetty"
envar: "SHLVL=1"
envar: "JETTY_GPG_KEYS=AED5EE6C45D0FE8D5D1B164F27DED4BF6216DB8F 	2A684B57436A81FA8706B53C61C3351A438A3B7D 	5989BAF76217B843D66BE55B2D0E1FB8FE4B68B4 	B59B67FD7904984367F931800818D9D68FB67BAC 	BFBB21C246D7776836287A48A04E0C74ABB35FEA 	8B096546B1A8F02656B15D3B1677D141BCF3584D 	F254B35617DC255D9344BCFA873A8E86B4372146 	E22488CC94F63E3FC928536C4241C08270D999C3"
envar: "JETTY_TGZ_URL=https://repo1.maven.org/maven2/org/eclipse/jetty/jetty-home/12.0.14/jetty-home-12.0.14.tar.gz"
envar: "LC_ALL=en_US.UTF-8"
envar: "JETTY_VERSION=12.0.14"
envar: "PATH=/usr/local/jetty/bin:/opt/java/openjdk/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
envar: "JAVA_VERSION=jdk-21.0.4+7"
envar: "_=/usr/bin/env"


mount: [
  {
    src: "/chroot"
    dst: "/"
    is_bind: true
  },
  {
    src: "/dev"
    dst: "/dev"
    is_bind: true
  },
  {
    src: "/dev/null"
    dst: "/dev/null"
    is_bind: true
    rw: true
  },
  {
    src: "/chroot/logs"
    dst: "/logs"
    is_bind: true
    rw: true
  },
  {
    src: "/chroot/var/lib/jetty"
    dst: "/var/lib/jetty"
    is_bind: true
    rw: true
  },
  {
    dst: "/tmp"
    fstype: "tmpfs"
    rw: true
  }
]
